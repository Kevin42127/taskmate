<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TodoApp.ViewModels"
        xmlns:models="using:TodoApp.Models"
        xmlns:utils="using:TodoApp.Utils"
        x:Class="TodoApp.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="待辦事項管理器"
        Width="1000" Height="700"
        MinWidth="600" MinHeight="400"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource BackgroundBrush}"
        Icon="avares://TodoApp/Assets/app.ico">
  <Window.Resources>
    <utils:BoolInverseConverter x:Key="BoolInverse"/>
    <utils:TodoItemBackgroundConverter x:Key="TodoItemBackground"/>
    <utils:TodoItemBorderConverter x:Key="TodoItemBorderConverter"/>
    <utils:TodoItemTextColorConverter x:Key="TodoItemTextColorConverter"/>
    <utils:BoolToTextDecorationsConverter x:Key="BoolToTextDecorations"/>
  </Window.Resources>
  <Window.Styles>
    <Style Selector="Button.delete-button">
      <Setter Property="Background" Value="Transparent"/>
      <Setter Property="Foreground" Value="#757575"/>
      <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Padding" Value="8"/>
      <Setter Property="Cursor" Value="Hand"/>
      <Setter Property="FontSize" Value="18"/>
      <Setter Property="FontWeight" Value="Bold"/>
      <Setter Property="Width" Value="32"/>
      <Setter Property="Height" Value="32"/>
      <Setter Property="HorizontalContentAlignment" Value="Center"/>
      <Setter Property="VerticalContentAlignment" Value="Center"/>
    </Style>
    <Style Selector="Button.delete-button:pointerover">
      <Setter Property="Background" Value="#FFEBEE"/>
      <Setter Property="Foreground" Value="#F44336"/>
      <Setter Property="Opacity" Value="1"/>
    </Style>
    <Style Selector="Border.todo-item-card">
      <Setter Property="BorderThickness" Value="1"/>
      <Setter Property="CornerRadius" Value="12"/>
      <Setter Property="Margin" Value="12"/>
      <Setter Property="Padding" Value="20"/>
      <Setter Property="MinHeight" Value="120"/>
      <Setter Property="Width" Value="280"/>
      <Setter Property="BoxShadow" Value="0 2 8 0 #1A000000"/>
    </Style>
    <Style Selector="Border.todo-item-card:pointerover">
      <Setter Property="Background" Value="#FAFAFA"/>
      <Setter Property="BorderBrush" Value="#BDBDBD"/>
      <Setter Property="BoxShadow" Value="0 4 12 0 #1F000000"/>
    </Style>
    <Style Selector="ScrollViewer">
      <Setter Property="Background" Value="#FAFAFA"/>
      <Setter Property="Padding" Value="0,8"/>
    </Style>
    <Style Selector="Button.filter-button">
      <Setter Property="Background" Value="#F5F5F5"/>
      <Setter Property="Foreground" Value="#757575"/>
    </Style>
    <Style Selector="Button.filter-button.active">
      <Setter Property="Background" Value="#E3F2FD"/>
      <Setter Property="Foreground" Value="#1976D2"/>
      <Setter Property="FontWeight" Value="SemiBold"/>
    </Style>
    <Style Selector="Button.filter-button:pointerover">
      <Setter Property="Background" Value="#E0E0E0"/>
    </Style>
    <Style Selector="Button.filter-button.active:pointerover">
      <Setter Property="Background" Value="#BBDEFB"/>
    </Style>
  </Window.Styles>

  <Grid RowDefinitions="Auto,Auto,*,Auto" Margin="0" 
          PointerPressed="OnMainWindowPointerPressed"
          PointerReleased="OnMainWindowPointerReleased"
          Focusable="True">
    <Border Grid.Row="0" Background="#F5F5F5" Padding="20,16" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1"
            PointerPressed="OnMainWindowPointerPressed">
      <Grid ColumnDefinitions="*,Auto,Auto">
        <TextBlock Grid.Column="0" Text="待辦事項" FontSize="24" FontWeight="SemiBold" 
                   Foreground="#212121"
                   VerticalAlignment="Center"/>
        <Button Grid.Column="1" 
                Content="刪除全部"
                Click="OnDeleteAllClick"
                Background="#F44336"
                Foreground="White"
                Padding="20,10"
                BorderThickness="0"
                CornerRadius="6"
                Cursor="Hand"
                FontSize="14"
                FontWeight="SemiBold"
                Margin="0,0,12,0"
                IsEnabled="{Binding HasTodos}"/>
        <Button Grid.Column="2" 
                Content="+ 新增"
                Click="OnAddClick"
                Background="#2196F3"
                Foreground="White"
                Padding="20,10"
                BorderThickness="0"
                CornerRadius="6"
                Cursor="Hand"
                FontSize="14"
                FontWeight="SemiBold"/>
      </Grid>
    </Border>

    <Border Grid.Row="1" Background="#FAFAFA" Padding="20,12" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
      <Grid ColumnDefinitions="*,Auto">
        <TextBox Grid.Column="0"
                 x:Name="SearchTextBox"
                 Text="{Binding SearchText}"
                 Watermark="搜尋待辦事項..."
                 Height="40"
                 FontSize="14"
                 Padding="12,0"
                 VerticalAlignment="Center"
                 Background="White"
                 BorderBrush="#E0E0E0"
                 BorderThickness="1"
                 CornerRadius="6"/>
        <StackPanel Grid.Column="1" Orientation="Horizontal" x:Name="FilterButtons" Margin="12,0,0,0">
          <Button Content="全部"
                  Padding="16,8"
                  Background="#E3F2FD"
                  Foreground="#1976D2"
                  BorderThickness="0"
                  CornerRadius="6"
                  FontSize="13"
                  FontWeight="SemiBold"
                  Cursor="Hand"
                  Tag="All"
                  Click="OnFilterClick"
                  Classes="filter-button active"
                  Margin="0,0,8,0"/>
          <Button Content="待完成"
                  Padding="16,8"
                  Background="#F5F5F5"
                  Foreground="#757575"
                  BorderThickness="0"
                  CornerRadius="6"
                  FontSize="13"
                  Cursor="Hand"
                  Tag="Pending"
                  Click="OnFilterClick"
                  Classes="filter-button"
                  Margin="0,0,8,0"/>
          <Button Content="已完成"
                  Padding="16,8"
                  Background="#F5F5F5"
                  Foreground="#757575"
                  BorderThickness="0"
                  CornerRadius="6"
                  FontSize="13"
                  Cursor="Hand"
                  Tag="Completed"
                  Click="OnFilterClick"
                  Classes="filter-button"/>
        </StackPanel>
      </Grid>
    </Border>

    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" 
                  HorizontalScrollBarVisibility="Disabled"
                  PointerPressed="OnMainWindowPointerPressed">
      <ItemsControl ItemsSource="{Binding FilteredTodos}">
        <ItemsControl.ItemsPanel>
          <ItemsPanelTemplate>
            <WrapPanel Orientation="Horizontal" Margin="16"/>
          </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
          <DataTemplate DataType="models:TodoItem">
            <Border Background="{Binding IsCompleted, Converter={StaticResource TodoItemBackground}}"
                    BorderBrush="{Binding IsCompleted, Converter={StaticResource TodoItemBorderConverter}}"
                    Classes="todo-item-card"
                    PointerPressed="OnCardPointerPressed"
                    Cursor="Hand">
              <Grid RowDefinitions="Auto,*,Auto">
                <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                  <CheckBox Grid.Column="0" 
                           IsChecked="{Binding IsCompleted}"
                           IsCheckedChanged="OnCheckBoxChanged"
                           VerticalAlignment="Top"
                           HorizontalAlignment="Left"
                           Width="24"
                           Height="24"
                           Cursor="Hand"/>
                  <Button Grid.Column="1"
                         Content="×"
                         Classes="delete-button"
                         Click="OnDeleteClick"
                         Opacity="0.6"
                         HorizontalAlignment="Right"
                         VerticalAlignment="Top"/>
                </Grid>
                <TextBlock Grid.Row="1" 
                          Text="{Binding Title}" 
                          TextWrapping="Wrap"
                          Foreground="{Binding IsCompleted, Converter={StaticResource TodoItemTextColorConverter}}"
                          FontSize="15"
                          VerticalAlignment="Center"
                          Margin="0,12,0,8"
                          TextDecorations="{Binding IsCompleted, Converter={StaticResource BoolToTextDecorations}}"/>
                <StackPanel Grid.Row="2" 
                           Orientation="Horizontal" 
                           Spacing="4" 
                           HorizontalAlignment="Right"
                           VerticalAlignment="Bottom"
                           Margin="0,0,0,8">
                  <ItemsControl ItemsSource="{Binding Tags}">
                    <ItemsControl.ItemsPanel>
                      <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="4"/>
                      </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="#F5F5F5" 
                                Padding="4,2"
                                CornerRadius="4">
                          <TextBlock Text="{Binding}" 
                                     FontSize="10"
                                     Foreground="#757575"/>
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
              </Grid>
            </Border>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>

    <Border Grid.Row="3" Background="#F9F9F9" 
            Padding="20,12" HorizontalAlignment="Stretch"
            BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
      <TextBlock Text="{Binding StatusText}"
                 Foreground="#757575"
                 FontSize="13"
                 VerticalAlignment="Center"/>
    </Border>
  </Grid>
</Window>
